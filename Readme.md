# Получение последних новостей с [mosmetro.ru/news ]()

# Задача:

Написать API, которое получает новости за заданный период из базы
и парсер который каждые 10 минут парсит новости
с сайта https://mosmetro.ru/news
и сохраняет в базу с меткой когда эти новости спаршены, 

пример метода
/metro/news?day=5

в качестве ответа вернуть JSON новости которые опубликованы за последний 5 дней (включительно) 
заголовок 
url картинки
дата публикации (YYYY-mm-dd)

# Запуск
`docker compose up --build`

Подождать загрузки данных в базу и перейти по адресу: [127.0.0.1:5001/news/?day=1]()

# API
`/news`
- day: int - количество дней от текущей даты за которое нужны новости
- limit: int - ограничение в количестве результатов
- offset: int - смещение для организации пагинации

# data_loader

Здесь скрипты для парсинга новостей с сайта и загрузки в базу.
Сделал немного абстракций на случай если понадобится еще откуда-то грузить данные.
Дату вместо даты парсинга я достал из поля и преобразовал в datetime

Периодический запуск скриптов происходит с помощью `Celery`.  

### Сделать бы еще:
- Возможно стоит сделать абстракцию для парсинга, хотя текущая
реализация позволяет подключать кастомные парсеры
- Попытаться объединить celery worker и beat в один инстанс,
не получилось сделать это сразу

# news_api

Приложение на `flask`, открывающая ручку для поучения новостей
с фильтрацией по количеству дней, смещению и лимиту.

### Сделать бы еще:
- Валидация входящих параметров, например, чтоб limit не
был выше определенного значения
- Перенести код ручки в отдельный файл
- Кажется оверхедом как сейчас происходит сбор и возврат результата из базы,
стоит посмотреть в сторону [FlaskPydanticSpec](https://github.com/turner-townsend/flask-pydantic-spec)
- Сделать сервис получения новостей классом
- Работу с базой сделать абстрактной, для подключения других бд

# Почему `MongoDB`:
- Нет необходимости в связях с другими таблицами
- Легкое горизонтальное масштабирование

### Сделать бы еще:
- Сделать скрипт для создания индекса базы с командой `db.news.createIndex({ date: -1 }`
- Логин и пароль к базе дефолтные - опасно, надо переделать
и убрать .env файл из репозитория он сейчас для упрощения запуска
- Проверить не будет ли ошибок из-за timezone
